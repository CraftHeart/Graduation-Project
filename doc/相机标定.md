# 相机标定
> 参考：[相机标定](http://blog.csdn.net/honyniu/article/details/51004397)
## 镜头畸变
一般来说，镜头畸变实际上时光学透镜固有的透视失真的总称，也就是因为透视原因造成的失真，这种失真对于照片的成像质量是非常不利的，毕竟摄影的
目的是为了再现。  
![畸变](https://github.com/CraftHeart/Graduation-Project/blob/project/doc/pic/%E7%95%B8%E5%8F%98.jpg)  
第一张是一个平整的画面。大家可以看到我们做的红色辅助线是完全横平竖直的，并没有发生任何的变形。第二张照片是桶形畸变。桶形畸变的意思就是整
个画面像酒桶一样，像个大肚皮一样鼓了出来，这叫桶形畸变。第三个画面是枕形畸变。枕形畸变像是古代的那种竹子编的枕头一样，向中间是带一点凹陷的。
在使用广角镜头或者是变焦镜头中的广角端或是超广角镜头的时候，我们常会发现画面中会发生桶形畸变，也就是中间的一种。使用长焦镜头或是变焦镜头的
长焦端的时候，我们经常会发现它有枕形畸变，就是右边的一种。这是镜头光学设计中的一种瑕疵，是那些光学的工程师们天天绞尽脑汁要消灭的一种东西。
因为它不再是还原自然了，他产生了自然界中没有的一种变形。  
除了桶形畸变和枕形畸变以外，在很多资料中，大家会列出第三种畸变叫做透视畸变。我不太愿意把透视畸变称之为畸变，因为它是自然界中本身就存在的
一种现象。举个例子，现在你用肉眼看正面的两个人，一个离你近一点，一个离你远一点，离你近的那个人，我们光用肉眼看就会发现他的脸的远比后边
那个人的脸要大得多。这是因为我们肉眼看世界，天生就有一个近大远小的立体透视效果。

## 相机标定
相机标定简单来说时从世界坐标系转换到图像坐标系的过程，也就是求最终的投影矩阵Ｐ的过程。   
基本坐标系：  
- 世界坐标系：也成为测量坐标系，时一个三维直角坐标系，以其为基准可以描述相机和待测物体的空间位置。世界坐标系的位置可以根据实际情况自由确定。
- 相机坐标系：也是一个三维直角坐标系，原点位于镜头光心处，x，ｙ轴分别与相面的两边平行，z轴为镜头光轴，与像面垂直。
- 图像坐标系    

一般来说，标定的过程分为两个部分：  
- 第一步是从世界坐标系转换为相机坐标系，这一步是三维点到三维点的转换，包括Ｒ,t(相机外参)等参数。
- 第二部分时从相机坐标系转为图像坐标系，这一步时三维点到二维点的转换，包括Ｋ(相机内参)等参数。  
### 齐次坐标系
参考：  
[齐次坐标系入门级思考](https://oncemore2020.github.io/blog/homogeneous/)  
[齐次坐标系](https://zh.wikipedia.org/wiki/%E9%BD%90%E6%AC%A1%E5%9D%90%E6%A0%87)  
齐次坐标就是将一个原本是n维的向量用一个n+1维向量来表示，是指一个用于投影几何里的坐标系统。齐次坐标表示是计算机图形学的重要手段之一，它既能够
明确区分向量和点，同时也更易于进行防射(线性)几何变换。
### 相机坐标系转换到图像坐标系
下图是一个小孔成像模型:  
![坐标系介绍](https://github.com/CraftHeart/Graduation-Project/blob/project/doc/pic/%E5%9D%90%E6%A0%87%E7%B3%BB%E4%BB%8B%E7%BB%8D.jpg)  
其中, 
- C点表示camera centre，即相机的中心点，也是相机坐标系的中心点；
- Z 轴表示principal axis，即相机的主轴；
- p 点所在的平面表示image plane，即相机的像平面，也就是图片坐标系所在的二维平面；
- p 点表示principal point，即主点，主轴与像平面相交的点；
- C 点到 p 点的距离，也就是右边图中的 f 表示focal length，即相机的焦距；
- 像平面上的 x 和 y 坐标轴是与相机坐标系上的 X 和 Y 坐标轴互相平行的；
- 相机坐标系是以 X， Y， Z（大写）三个轴组成的且原点在 C 点，度量值为米（m）；
- 像平面坐标系是以 x，y（小写）两个轴组成的且原点在 p 点，度量值为米（m）；
- 图像坐标系一般指图片相对坐标系，在这里可以认为和像平面坐标系在一个平面上，不过原点是在图片的角上，而且度量值为像素的个数（pixel）；
知道上面的简单知识之后，如果知道相机坐标系中的一个点Ｘ(现实三维世界中的点)，在像平面坐标系对应的点时x，要求从相机坐标系转为像平面坐标系，也就是
从Ｘ点的(X,Y,Z)通过一定的转换变为x点的(x,y)。其中，(X,Y,Z)是相机坐标系，(x,y)是像平面坐标系。  
![相机转换到像平面公式](https://github.com/CraftHeart/Graduation-Project/blob/project/doc/pic/%E7%9B%B8%E6%9C%BA%E8%BD%AC%E6%8D%A2%E5%88%B0%E5%83%8F%E5%B9%B3%E9%9D%A2%E5%85%AC%E5%BC%8F.png)  
可以表示为矩阵计算为(这里用的是齐次坐标的表示)：  
![齐次坐标系表示相机转换到平面的矩阵运算](https://github.com/CraftHeart/Graduation-Project/blob/project/doc/pic/%E9%BD%90%E6%AC%A1%E5%9D%90%E6%A0%87%E7%B3%BB%E8%A1%A8%E7%A4%BA%E7%9B%B8%E6%9C%BA%E8%BD%AC%E6%8D%A2%E5%88%B0%E5%B9%B3%E9%9D%A2%E7%9A%84%E7%9F%A9%E9%98%B5%E8%BF%90%E7%AE%97.png)  
可以简写为(P就是所谓的投影矩阵，目前还不够完整):  
x = PX
### 加入偏移量
通过上面，可以把相机坐标系转换到像平面坐标系，但是像平面坐标系和图像坐标系虽然在同一个平面上，但是原点并不是同一个，而且目标时要转换呢到图像坐标系下，
所以还需要如下的操作:  
![加入偏移](https://github.com/CraftHeart/Graduation-Project/blob/project/doc/pic/%E5%8A%A0%E5%85%A5%E5%81%8F%E7%A7%BB.png)  
其中，主点p是像平面坐标系的原点，但在图像坐标系中的位置为(px,py)，在这里，图形坐标系的原点时左下角，所以可以得到：  
(X,Y,Z) --> (fX/Z + px, fY/Z + py)  
相当于在上面的基础上加了一个ｐ点在图像坐标系的坐标的偏移量，同时可以表示为矩阵计算为(这里用齐次坐标的表示方法)：  
![齐次坐标系表示加入偏移量后的转换](https://github.com/CraftHeart/Graduation-Project/blob/project/doc/pic/%E9%BD%90%E6%AC%A1%E5%9D%90%E6%A0%87%E7%B3%BB%E8%A1%A8%E7%A4%BA%E5%8A%A0%E5%85%A5%E5%81%8F%E7%A7%BB%E9%87%8F%E5%90%8E%E7%9A%84%E8%BD%AC%E6%8D%A2.png)
### 像素坐标
前面也提到了在图像坐标系中用的不是现实生活中的m来度量，而是用像素的个数来度量，所以在上面转换到图像坐标系中还有一个问题，就是坐标的表示还是m，
并没有转换到像素坐标系统，在这里就需要引入一个新概念就是:  
- mx表示在水平方向1m的长度包含的像素的个数；
- my表示在竖直方向1m的长度包含的相熟的个数；  
这里使用mx和my，是为了通过上面可以得到一个像素点的大小(m度量)为:  
1/mx * 1/my

